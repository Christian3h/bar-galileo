{% extends "account/base_entrance.html" %}
{% load i18n %}
{% load allauth %}
{% block head_title %}
    {% trans "Email Address" %}
{% endblock head_title %}
{% block content %}
    <div class="container-login">
        {% element h1 %}
            {% trans "Cambiar Correo Electrónico" %}
        {% endelement %}
        
        {% if not emailaddresses %}
            {% include "account/snippets/warn_no_email.html" %}
        {% endif %}
        
        <!-- Sección de correo actual -->
        <div class="form-section">
            <h2>Información Actual</h2>
            {% if current_emailaddress %}
                <div class="email-info-item">
                    <label>Correo actual:</label>
                    <div class="email-display">
                        {{ current_emailaddress.email }}
                        {% if current_emailaddress.verified %}
                            <span class="badge badge-verified">Verificado</span>
                        {% else %}
                            <span class="badge badge-unverified">Sin verificar</span>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
            
            {% if new_emailaddress %}
                <div class="email-info-item pending-email">
                    <label>Cambiando a:</label>
                    <div class="email-display">
                        {{ new_emailaddress.email }}
                        <span class="badge badge-pending">Pendiente de verificación</span>
                    </div>
                    <div class="pending-actions">
                        <p class="help-text">Tu nueva dirección de correo está pendiente de verificación.</p>
                        <div class="button-group">
                            {% element button form="pending-email" type="submit" name="action_send" tags="secondary" %}
                                {% trans 'Reenviar Verificación' %}
                            {% endelement %}
                            {% if current_emailaddress %}
                                {% element button form="pending-email" type="submit" name="action_remove" tags="danger" %}
                                    {% trans 'Cancelar Cambio' %}
                                {% endelement %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        
        <!-- Formulario para cambiar email -->
        <div class="form-section">
            <h2>{% if new_emailaddress %}Cambiar a Otro Correo{% else %}Nuevo Correo Electrónico{% endif %}</h2>
            {% url 'account_email' as action_url %}
            {% element form method="post" action=action_url %}
                {% slot body %}
                    {% csrf_token %}
                    {% element field id=form.email.auto_id name="email" value=form.email.value errors=form.email.errors type="email" %}
                        {% slot label %}
                            {% translate "Nueva dirección de correo:" %}
                        {% endslot %}
                    {% endelement %}
                {% endslot %}
                {% slot actions %}
                    {% element button name="action_add" type="submit" tags="prominent,login" %}
                        {% trans "Cambiar Correo" %}
                    {% endelement %}
                {% endslot %}
            {% endelement %}
        </div>
        
        <!-- Formulario oculto para acciones de email pendiente -->
        {% if new_emailaddress %}
            <form style="display: none"
                id="pending-email"
                method="post"
                action="{% url 'account_email' %}">
                {% csrf_token %}
                <input type="hidden" name="email" value="{{ new_emailaddress.email }}">
            </form>
        {% endif %}
        
        <!-- Enlaces de navegación -->
        <div class="nav-links">
            <a href="{% url 'account_email' %}">Gestionar todos los correos</a>
            <a href="{% url 'account_change_password' %}">Cambiar contraseña</a>
            <a href="{% url 'core:index' %}">Volver al inicio</a>
        </div>
    </div>
{% endblock content %}
 