{% load humanize %}
{% load format_tags %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Usuario - Bar Galileo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <div class="bg-success text-white rounded-4 p-4 mb-4 text-center">
            <h1 class="mb-2">🍺 Bar Galileo</h1>
            <p class="mb-0">Panel de Usuario - Bienvenido, {{ datos.nombre }}</p>
        </div>

        <div class="row g-4">
            <!-- Cuenta Actual -->
            <div class="col-12 col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header d-flex align-items-center bg-light">
                        <span class="fs-2 me-3">💰</span>
                        <span class="h5 mb-0">Cuenta Actual</span>
                    </div>
                    <div class="card-body">
                        <div class="display-5 fw-bold text-success text-center mb-3">{{ datos.cuenta_actual.total|format_price }}</div>
                        <ul class="list-group mb-3">
                            {% for item in datos.cuenta_actual.items %}
                            <li class="list-group-item d-flex justify-content-between">{{ item.nombre }}<span>{{ item.precio|format_price }}</span></li>
                            {% endfor %}
                            <li class="list-group-item d-flex justify-content-between fw-bold text-success"><span><span class="badge bg-success rounded-circle me-2" style="width:12px;height:12px;"> </span>Total a Pagar</span><span>{{ datos.cuenta_actual.total|format_price }}</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Historial Mensual -->
            <div class="col-12 col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header d-flex align-items-center bg-light">
                        <span class="fs-2 me-3">📊</span>
                        <span class="h5 mb-0">Historial Mensual</span>
                    </div>
                    <div class="card-body">
                        <div class="mb-3 d-flex flex-wrap gap-2 justify-content-center">
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'ene')">Ene</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'feb')">Feb</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'mar')">Mar</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'abr')">Abr</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'may')">May</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'jun')">Jun</button>
                            <button class="btn btn-success btn-sm" onclick="selectMonth(this, 'jul')">Jul</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'ago')">Ago</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'sep')">Sep</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'oct')">Oct</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'nov')">Nov</button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectMonth(this, 'dic')">Dic</button>
                        </div>
                        <div class="d-flex align-items-end gap-2" style="height:200px;">
                            <div class="bg-success bg-gradient rounded-top w-100" style="height: 60%;" data-amount="$120k"></div>
                            <div class="bg-success bg-gradient rounded-top w-100" style="height: 80%;" data-amount="$160k"></div>
                            <div class="bg-success bg-gradient rounded-top w-100" style="height: 45%;" data-amount="$90k"></div>
                            <div class="bg-success bg-gradient rounded-top w-100" style="height: 90%;" data-amount="$180k"></div>
                            <div class="bg-success bg-gradient rounded-top w-100" style="height: 70%;" data-amount="$140k"></div>
                        </div>
                        <div class="text-center mt-3">
                            <span id="month-total">Total Julio 2025: $450.000</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información Personal -->
            <div class="col-12 col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header d-flex align-items-center bg-light">
                        <span class="fs-2 me-3">👤</span>
                        <span class="h5 mb-0">Mi Información</span>
                    </div>
                    <div class="card-body">
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between"><strong>Nombre:</strong><span>{{ datos.nombre }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Cédula:</strong><span>{{ datos.cedula }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Teléfono:</strong><span>{{ datos.telefono }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Email:</strong><span>{{ datos.email }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Dirección:</strong><span>{{ datos.direccion }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Cliente desde:</strong><span>{{ datos.cliente_desde }}</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Contacto de Emergencia -->
            <div class="col-12 col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header d-flex align-items-center bg-light">
                        <span class="fs-2 me-3">🚨</span>
                        <span class="h5 mb-0">Contacto de Emergencia</span>
                    </div>
                    <div class="card-body">
                        <ul class="list-group mb-3">
                            <li class="list-group-item d-flex justify-content-between"><strong>Nombre:</strong><span>{{ datos.emergencia.nombre }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Relación:</strong><span>{{ datos.emergencia.relacion }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Teléfono:</strong><span>{{ datos.emergencia.telefono }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Teléfono Alternativo:</strong><span>{{ datos.emergencia.telefono_alt }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Tipo de Sangre:</strong><span>{{ datos.emergencia.sangre }}</span></li>
                            <li class="list-group-item d-flex justify-content-between"><strong>Alergias:</strong><span>{{ datos.emergencia.alergias }}</span></li>
                        </ul>
                        <button class="btn btn-danger w-100" onclick="callEmergency()">📞 Llamar en Emergencia</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

  <script>
function selectMonth(button, month) {
  document.querySelectorAll('.month-btn').forEach(btn => btn.classList.remove('active'));
  button.classList.add('active');

  const bars = document.querySelectorAll('.chart-bar');

  const monthData = {
    'ene': [60, 40, 20, 70, 50],
    'feb': [50, 75, 45, 85, 65],
    'mar': [60, 80, 55, 90, 70],
    'abr': [70, 85, 60, 95, 75],
    'may': [55, 70, 45, 80, 65],
    'jun': [60, 90, 50, 100, 75],
    'jul': [65, 85, 50, 95, 75],
    'ago': [0, 0, 0, 0, 0],
    'sep': [0, 0, 0, 0, 0],
    'oct': [0, 0, 0, 0, 0],
    'nov': [0, 0, 0, 0, 0],
    'dic': [0, 0, 0, 0, 0]
  };

  const monthAmounts = {
    'ene': ['$40k', '$60k', '$30k', '$70k', '$50k'],
    'feb': ['$50k', '$75k', '$45k', '$85k', '$65k'],
    'mar': ['$60k', '$80k', '$55k', '$90k', '$70k'],
    'abr': ['$70k', '$85k', '$60k', '$95k', '$75k'],
    'may': ['$55k', '$70k', '$45k', '$80k', '$65k'],
    'jun': ['$60k', '$90k', '$50k', '$100k', '$75k'],
    'jul': ['$65k', '$85k', '$50k', '$95k', '$75k'],
    'ago': ['$0k', '$0k', '$0k', '$0k', '$0k'],
    'sep': ['$0k', '$0k', '$0k', '$0k', '$0k'],
    'oct': ['$0k', '$0k', '$0k', '$0k', '$0k'],
    'nov': ['$0k', '$0k', '$0k', '$0k', '$0k'],
    'dic': ['$0k', '$0k', '$0k', '$0k', '$0k']
  };

  const monthNames = {
    'ene': 'Enero', 'feb': 'Febrero', 'mar': 'Marzo', 'abr': 'Abril',
    'may': 'Mayo', 'jun': 'Junio', 'jul': 'Julio', 'ago': 'Agosto',
    'sep': 'Septiembre', 'oct': 'Octubre', 'nov': 'Noviembre', 'dic': 'Diciembre'
  };

  bars.forEach((bar, i) => {
    bar.style.height = monthData[month][i] + '%';
    bar.setAttribute('data-amount', monthAmounts[month][i]);
  });

  // Calcular el total sumando los montos (removiendo $ y k)
  const total = monthAmounts[month]
    .map(val => parseInt(val.replace(/[$k]/g, '')) * 1000)
    .reduce((sum, num) => sum + num, 0);

  document.getElementById('month-total').innerHTML =
    `Total ${monthNames[month]} 2025: $${total.toLocaleString()}`;
}



    function callEmergency() {
      if (confirm('¿Estás seguro de que deseas llamar al contacto de emergencia?')) {
        alert('Llamando a María Elena Mendoza: +57 310 123 4567\n\n¡El personal del bar también ha sido notificado!');
      }
    }

    // Animación de entrada para las tarjetas
    window.addEventListener('load', () => {
      const cards = document.querySelectorAll('.card');
      cards.forEach((card, i) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
          card.style.transition = 'all 0.6s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, i * 200);
      });
    });

  </script>
</body>
</html>
