{% extends 'base_admin.html' %}
{% load static %}
{% load format_tags %}

{% block extra_css%}
  <link rel="stylesheet" href="{% static 'css/main/admin/tables.css' %}">
    <link rel="stylesheet" href="{% static 'css/main/facturacion/facturacion.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h2 class="dashboard-title">Gestión de Facturas</h2>

    <!-- Estadísticas -->
    <section class="dashboard-cards">
        <div class="card">
            <h3>Total Facturas</h3>
            <p>{{ estadisticas.total_facturas }}</p>
        </div>
        <div class="card">
            <h3>Ingresos Totales</h3>
            <p>{{ estadisticas.total_ingresos|format_price }}</p>
        </div>
        <div class="card">
            <h3>Facturas Hoy</h3>
            <p>{{ estadisticas.facturas_hoy }}</p>

        </div>
        <div class="card">
            <h3>Ingresos Hoy</h3>
            <p>{{ estadisticas.ingresos_hoy|format_price }}</p>
        </div>
    </section>

    <!-- Filtros de búsqueda -->
    <div class="search-container">
        <form method="GET" class="search-form">
            <div class="search-fields">
                <div class="field-group">
                    <label>Buscar:</label>
                    <input type="text"
                           name="busqueda"
                           value="{{ busqueda }}"
                           placeholder="Número de factura o mesa...">
                </div>
                <div class="field-group">
                    <label>Fecha Inicio:</label>
                    <input type="date"
                           name="fecha_inicio"
                           value="{{ fecha_inicio }}">
                </div>
                <div class="field-group">
                    <label>Fecha Fin:</label>
                    <input type="date"
                           name="fecha_fin"
                           value="{{ fecha_fin }}">
                </div>
            </div>
            <div class="field-group buttons-group">
                <button type="submit" class="btn btn-primary">Buscar</button>
                <a href="{% url 'facturacion:lista_facturas' %}" class="btn btn-secondary">Limpiar</a>
            </div>
        </form>
    </div>

    <!-- Lista de facturas -->
    <div class="table-responsive">
        <table id="tabla-facturas" class="table table-striped table-bordered nowrap">
            <thead>
                <tr>
                    <th>Número</th>
                    <th class="hide-mobile">Mesa</th>
                    <th>Fecha</th>
                    <th>Total</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for factura in page_obj %}
                <tr>
                    <td class="factura-numero">#{{ factura.numero }}</td>
                    <td class="hide-mobile">
                        {% if factura.mesa_nombre %}
                            {{ factura.mesa_nombre }}
                        {% else %}
                            <span class="text-muted">Sin mesa</span>
                        {% endif %}
                    </td>
                    <td class="fecha-cell">{{ factura.fecha|date:"d/m/Y H:i" }}</td>
                    <td class="total-cell">{{ factura.total|format_price }}</td>
                    <td class="actions-cell">
                                <a href="{% url 'facturacion:detalle_factura' factura.id %}"
                                    class="btn btn-sm btn-primary btn-view"
                                    title="Ver detalles">Ver</a>
                                <a href="{% url 'facturacion:eliminar_factura' factura.id %}"
                                    class="btn btn-sm btn-danger btn-delete"
                                    title="Eliminar factura"
                                    ><img src="{% static 'img/icons/delete.svg' %}" alt="Eliminar"></a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-muted">
                        No se encontraron facturas con los criterios especificados.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#tabla-facturas').DataTable({
        "language": {
            "url": "{% static 'js/DataTables/es-ES.json' %}"
        },
        responsive: true,
        "pageLength": 10,
        "lengthChange": true,
        "ordering": true
    });
});
</script>


{% endblock %}
