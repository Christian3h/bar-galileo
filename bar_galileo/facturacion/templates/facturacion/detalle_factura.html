{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Detalle de Factura #{{ factura.numero }}{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="header-section">
        <h2 class="dashboard-title">Factura #{{ factura.numero }}</h2>
        <div class="header-actions">
            <a href="{% url 'facturacion:lista_facturas' %}" class="btn btn-secondary">‚Üê Volver a la lista</a>
        </div>
    </div>

    <div class="factura-detail">
        <div class="info-section">
            <h3>Informaci√≥n General</h3>
            <div class="info-grid">
                <div class="info-item">
                    <label>N√∫mero de Factura:</label>
                    <span class="factura-numero">#{{ factura.numero }}</span>
                </div>
                <div class="info-item">
                    <label>Fecha:</label>
                    <span>{{ factura.fecha|date:"d/m/Y H:i" }}</span>
                </div>
                <div class="info-item">
                    <label>Mesa:</label>
                    <span>
                        {% if factura.pedido.mesa %}
                            {{ factura.pedido.mesa.nombre }}
                        {% else %}
                            <span class="text-muted">Sin mesa asignada</span>
                        {% endif %}
                    </span>
                </div>
                <div class="info-item">
                    <label>Estado del Pedido:</label>
                    <span class="estado-badge estado-{{ factura.pedido.estado }}">
                        {{ factura.pedido.get_estado_display }}
                    </span>
                </div>
            </div>
        </div>

        <div class="items-section">
            <h3>Detalles del Pedido</h3>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th class="hide-mobile">Precio Unitario</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in factura.pedido.items.all %}
                        <tr>
                            <td>{{ item.producto.nombre }}</td>
                            <td class="text-center">{{ item.cantidad }}</td>
                            <td class="text-right hide-mobile">${{ item.precio_unitario|floatformat:2 }}</td>
                            <td class="text-right">${{ item.subtotal|floatformat:2 }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">
                                No hay items en este pedido
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="3" class="hide-mobile"><strong>Total:</strong></td>
                            <td colspan="2" class="show-mobile"><strong>Total:</strong></td>
                            <td class="text-right"><strong>${{ factura.total|floatformat:2 }}</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="actions-section">
            <div class="action-buttons">
                <a href="{% url 'facturacion:eliminar_factura' factura.id %}" 
                   class="btn btn-danger"
                   onclick="return confirm('¬øEst√°s seguro de que deseas eliminar esta factura? Esta acci√≥n no se puede deshacer.')">
                    üóëÔ∏è Eliminar Factura
                </a>
                <button onclick="window.print()" class="btn btn-primary">
                    üñ®Ô∏è Imprimir
                </button>
            </div>
        </div>
    </div>
</div>

<style>
/* Header section */
.header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

/* Detalle de factura */
.factura-detail {
    background: transparent;
    border: 2px solid var(--color-primary);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.info-section, .items-section {
    margin-bottom: 2rem;
}

.info-section h3, .items-section h3 {
    color: var(--color-secondary);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--color-primary);
    font-size: 1.3rem;
}

/* Grid de informaci√≥n */
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.info-item {
    background: transparent;
    border: 1px solid var(--color-primary);
    padding: 1rem;
    border-radius: 8px;
}

.info-item label {
    display: block;
    font-weight: 600;
    color: var(--color-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.info-item span {
    font-size: 1rem;
    color: var(--color-accent);
    word-break: break-word;
}

.factura-numero {
    font-family: monospace;
    font-weight: bold;
    color: var(--color-secondary);
    font-size: 1.2rem !important;
}

/* Estados */
.estado-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    display: inline-block;
}

.estado-en_proceso {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.estado-facturado {
    background: #d1edff;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.estado-cancelado {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

/* Tabla responsive */
.table-responsive {
    background: transparent;
    border: 2px solid var(--color-primary);
    border-radius: 8px;
    overflow: hidden;
}

.table {
    width: 100% !important;
    margin: 0;
}

.table th {
    background: var(--color-primary);
    color: white;
    font-weight: 600;
    padding: 1rem;
    text-align: left;
}

.table td {
    padding: 0.75rem;
    border-bottom: 1px solid var(--color-primary);
}

.table tbody tr:hover {
    background: rgba(162, 137, 50, 0.1);
}

.total-row {
    background: var(--color-secondary) !important;
    color: white;
    font-weight: 600;
}

.total-row td {
    border-top: 2px solid var(--color-primary);
    padding: 1rem;
}

/* Acciones */
.actions-section {
    background: rgba(162, 137, 50, 0.1);
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid var(--color-primary);
}

.action-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.text-muted {
    color: var(--color-gray);
    font-style: italic;
}

.hide-mobile {
    display: table-cell;
}

.show-mobile {
    display: none;
}

/* Responsive design */
@media (max-width: 768px) {
    .header-section {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
    }
    
    .factura-detail {
        padding: 1rem;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
    }
    
    .info-section h3, .items-section h3 {
        font-size: 1.1rem;
    }
    
    .hide-mobile {
        display: none;
    }
    
    .show-mobile {
        display: table-cell;
    }
    
    .table th,
    .table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.9rem;
    }
    
    .action-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .action-buttons .btn {
        width: 100%;
        max-width: 250px;
    }
}

@media (max-width: 480px) {
    .dashboard-title {
        font-size: 1.5rem;
    }
    
    .info-item {
        padding: 0.75rem;
    }
    
    .info-item label {
        font-size: 0.8rem;
    }
    
    .info-item span {
        font-size: 0.9rem;
    }
    
    .table th,
    .table td {
        padding: 0.375rem 0.125rem;
        font-size: 0.8rem;
    }
    
    .factura-numero {
        font-size: 1rem !important;
    }
    
    .actions-section {
        padding: 1rem;
    }
}

/* Estilos para impresi√≥n */
@media print {
    .header-actions,
    .actions-section {
        display: none !important;
    }
    
    .factura-detail {
        border: 1px solid #000;
        box-shadow: none;
    }
    
    .info-item {
        border: 1px solid #ccc;
    }
    
    .table-responsive {
        border: 1px solid #000;
    }
    
    .hide-mobile {
        display: table-cell !important;
    }
    
    .show-mobile {
        display: none !important;
    }
}
</style>
{% endblock %}
