{% extends 'base.html' %}
{% load static %}
{% load format_tags %}

{% block title %}{{ producto.nombre }} - Detalle{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/main/products/product_detail.css' %}">
{% endblock %}

{% block content %}
<div class="detalle-container">
    <div class="gallery-container">
        <img id="mainProductImage" src="{{ producto.imagenes.first.imagen.url }}" class="main-image-display" alt="{{ producto.nombre }}">
        <div class="thumbnail-container">
            {% for imagen in producto.imagenes.all %}
                <img src="{{ imagen.imagen.url }}" class="product-thumbnail {% if forloop.first %}active{% endif %}" alt="Thumbnail {{ forloop.counter }}">
            {% endfor %}
        </div>
    </div>

    <h1 class="detalle-nombre">{{ producto.nombre }}</h1>
    <p class="detalle-precio">{{ producto.precio_venta|format_price }}</p>
    <p class="detalle-desc">{{ producto.descripcion|default:"Sin descripción." }}</p>

    <div class="detalle-info">
        <p><strong>Categoría:</strong> {{ producto.id_categoria.nombre_categoria|default:"N/A" }}</p>
        <p><strong>Marca:</strong> {{ producto.id_marca.marca|default:"N/A" }}</p>
        <p><strong>Stock:</strong> {{ producto.stock|default:"0" }} unidades</p>
    </div>

    <a href="{% url 'core:store' %}" class="detalle-volver">Volver a la tienda</a>
</div>

{% if productos_relacionados %}
<div class="productos-relacionados-container">
    <h2>Productos Relacionados</h2>
    <div class="productos-relacionados-grid">
        {% for prod_relacionado in productos_relacionados %}
            <div class="product-card">
                {% if prod_relacionado.imagenes.exists %}
                    <img src="{{ prod_relacionado.imagenes.first.imagen.url }}" class="product-img" alt="{{ prod_relacionado.nombre }}">
                {% else %}
                    <img src="https://via.placeholder.com/400x300?text=Sin+Imagen" class="product-img" alt="{{ prod_relacionado.nombre }}">
                {% endif %}
                <h3>{{ prod_relacionado.nombre }}</h3>
                <p>{{ prod_relacionado.precio_venta|format_price }}</p>
                <a href="{% url 'products:producto_detalle' prod_relacionado.id_producto %}" class="btn-view-product">Ver Producto</a>
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainImage = document.getElementById('mainProductImage');
    const thumbnails = document.querySelectorAll('.product-thumbnail');

    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            // Remover la clase 'active' de todas las miniaturas
            thumbnails.forEach(thumb => thumb.classList.remove('active'));
            // Establecer la imagen principal a la fuente de la miniatura clicada
            mainImage.src = this.src;
            // Añadir la clase 'active' a la miniatura clicada
            this.classList.add('active');
        });
    });
});
</script>
{% endblock %}
