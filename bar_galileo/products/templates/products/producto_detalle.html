{% extends 'base.html' %}
{% load static %}
{% load format_tags %}

{% block title %}{{ producto.nombre }} - Detalle{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/main/products/product_detail.css' %}">
<style>
    /* Estilos para la galería de imágenes */
    .gallery-container {
        width: 100%;
        max-width: 500px; /* Ajusta según sea necesario */
        margin: 0 auto 20px auto;
        position: relative;
    }
    .main-image-display {
        width: 100%;
        height: 350px; /* Altura fija para las imágenes principales */
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 10px;
        background: #222;
    }
    .thumbnail-container {
        display: flex;
        justify-content: center;
        gap: 10px;
        overflow-x: auto;
        padding-bottom: 10px; /* Espacio para la barra de desplazamiento si aparece */
    }
    .thumbnail-container img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.2s ease;
    }
    .thumbnail-container img.active,
    .thumbnail-container img:hover {
        border-color: #d4af37;
    }
</style>
{% endblock %}

{% block content %}
<div class="detalle-container">
    <div class="gallery-container">
        <img id="mainProductImage" src="{% static producto.imagenes.first.imagen %}" class="main-image-display" alt="{{ producto.nombre }}">
        <div class="thumbnail-container">
            {% for imagen in producto.imagenes.all %}
                <img src="{% static imagen.imagen %}" class="product-thumbnail {% if forloop.first %}active{% endif %}" alt="Thumbnail {{ forloop.counter }}">
            {% endfor %}
        </div>
    </div>

    <h1 class="detalle-nombre">{{ producto.nombre }}</h1>
    <p class="detalle-precio">{{ producto.precio_venta|format_price }}</p>
    <p class="detalle-desc">{{ producto.descripcion|default:"Sin descripción." }}</p>

    <div class="detalle-info">
        <p><strong>Categoría:</strong> {{ producto.id_categoria.nombre_categoria|default:"N/A" }}</p>
        <p><strong>Marca:</strong> {{ producto.id_marca.marca|default:"N/A" }}</p>
        <p><strong>Stock:</strong> {{ producto.stock|default:"0" }} unidades</p>
    </div>

    <a href="{% url 'core:store' %}" class="detalle-volver">Volver a la tienda</a>
</div>

{% if productos_relacionados %}
<div class="productos-relacionados-container">
    <h2>Productos Relacionados</h2>
    <div class="productos-relacionados-grid">
        {% for prod_relacionado in productos_relacionados %}
            <div class="product-card">
                {% if prod_relacionado.imagenes.exists %}
                    <img src="{% static prod_relacionado.imagenes.first.imagen %}" class="product-img" alt="{{ prod_relacionado.nombre }}">
                {% else %}
                    <img src="https://via.placeholder.com/400x300?text=Sin+Imagen" class="product-img" alt="{{ prod_relacionado.nombre }}">
                {% endif %}
                <h3>{{ prod_relacionado.nombre }}</h3>
                <p>{{ prod_relacionado.precio_venta|format_price }}</p>
                <a href="{% url 'products:producto_detalle' prod_relacionado.id_producto %}" class="btn-view-product">Ver Producto</a>
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainImage = document.getElementById('mainProductImage');
    const thumbnails = document.querySelectorAll('.product-thumbnail');

    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            // Remover la clase 'active' de todas las miniaturas
            thumbnails.forEach(thumb => thumb.classList.remove('active'));
            // Establecer la imagen principal a la fuente de la miniatura clicada
            mainImage.src = this.src;
            // Añadir la clase 'active' a la miniatura clicada
            this.classList.add('active');
        });
    });
});
</script>
{% endblock %}
